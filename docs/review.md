# clens 要件定義書レビュー

## 重大な問題（実装前に必ず解決すべき）

| # | セクション | 問題 | 改善提案 |
|---|-----------|------|----------|
| 1 | 2 / 12 | US-7（アウトライン表示: Should）とセクション 12（将来の拡張候補）が矛盾。初期リリースに含むのか v2 送りなのか不明。 | どちらかに統一する。US-7 を残すならセクション 12 から削除、v2 送りなら US-7 を外す。 |
| 2 | 11.4 | npm パッケージサイズ 2MB 以下は非現実的。CodeMirror 6 + React 18 + react-markdown + chokidar 等を合算すると確実に超過する。 | 実測してから目標値を設定するか、「download size（gzip 後）」等の計測基準を明確にする。 |
| 3 | 11.2 | Node.js >= 18.0.0 と記載されているが、Node.js 18 は 2025 年 4 月に EOL 済み。 | `>= 20.0.0` に引き上げる。 |

## 改善推奨（品質向上のため対応が望ましい）

| # | セクション | 問題 | 改善提案 |
|---|-----------|------|----------|
| 1 | 8 | 対象ファイルが一切存在しない場合（新規プロジェクト等）の画面挙動が未定義。 | 空状態のガイダンス表示と、`.claude` ディレクトリの自動生成有無を明記する。 |
| 2 | 4.2 | 未保存変更がある状態でのファイル切り替え・タブ閉じ時の挙動が未定義。 | 確認ダイアログの要否を決めて記載する。 |
| 3 | 4.2 | `Ctrl+S` / `Cmd+S` で保存できるかどうかが不明。開発者ツールとしては自然な期待。 | 対応するなら US またはセクション 4 に一行追記するだけで十分。 |
| 4 | 4.1 | US-8（ファイル削除: Should）の UI が画面構成に未反映。どこから削除操作するのか不明。 | コンテキストメニューかアイコンか、方針だけ記載する。 |
| 5 | 6.3 | `FileNode.description` の抽出元が「先頭行**等**」と曖昧。コマンドファイルの扱いが不明。 | カテゴリごとの抽出ルールを一行ずつ書く。 |

## 軽微な指摘（対応は任意）

| # | セクション | 問題 | 改善提案 |
|---|-----------|------|----------|
| 1 | 5.3 | `src/server/types.ts` と `src/shared/types.ts` の役割分担が不明。 | 一言コメントで棲み分けを書く。 |
| 2 | 11.1 | 「プレビュー反映まで 100ms 以内（デバウンス適用）」はデバウンス間隔なのか描画完了なのか曖昧。 | どちらを指すか明記する。 |
| 3 | 4.2 | Split View のリサイズ可否が未定義。固定 50:50 なら明示する。 | 一言追記。 |

## 総合評価

**成熟度: 4 / 5（軽微な修正で実装着手可能）**

全体としてよく書けている。プロダクトビジョンからAPI設計、動作フロー、競合ハンドリングまで一通り網羅されており、difit という参考実装もあるため、実装者がこの文書を読んで手を動かし始めるのに十分な情報量がある。セキュリティ方針（localhost バインド、パストラバーサル防止、対象ファイル限定）も要件レベルでは記載されており、具体的な実装手法は実装時に決めれば良い。

### 最も優先的に改善すべき上位 3 点

1. **US-7 とセクション 12 の矛盾解消** — スコープの曖昧さは実装判断に直結するため、先に決めるべき。
2. **パッケージサイズ目標の現実性確認** — 達成不可能な数値目標を掲げると後で混乱する。実測ベースで再設定。
3. **Node.js 最低バージョンの更新** — EOL バージョンをサポート下限にすべきでない。
